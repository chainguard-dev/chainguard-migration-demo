FROM cgr.dev/americanexpress.com/jdk:openjdk-17-dev as build

USER 0
RUN apk add --no-cache maven git
WORKDIR /app/vertx-examples/redis-examples
RUN git clone --depth=1 https://github.com/vert-x3/vertx-examples.git /app/vertx-examples/redis-examples
COPY docker/vertx/pom.xml .
RUN mvn clean package

FROM cgr.dev/americanexpress.com/jre:openjdk-17-dev
COPY --from=build /app/vertx-examples/redis-examples/target/vertx-redis-client-*.jar /app/vertx-redis-client.jar

WORKDIR /app
EXPOSE 8080

ENTRYPOINT ["java"]
CMD ["-jar", "/app/vertx-redis-client.jar"]
